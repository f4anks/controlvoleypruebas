<!DOCTYPE html>
<html lang="es">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Voley Stats Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        :root{
            --color-main-bg:#F7F8FA;
            --color-card-bg:#ffffff;
            --color-text-dark:#1f2937;
            --color-primary-blue:#0056FF;
            --color-secondary-red:#dc2626;
            --color-neutral-orange:#f97316;
            --color-stat-row-bg:#f3f4f6
        }
        body{
            font-family:'Inter',sans-serif;
            user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;
            background-color:var(--color-main-bg);
            display: none; /* Se muestra solo al autenticar */
        }
        .card{
            background-color:var(--color-card-bg);
            color:var(--color-text-dark);
            border:1px solid #d1d5db;
            transition:transform .2s ease-in-out,box-shadow .2s ease-in-out;
            box-shadow:0 4px 10px -1px rgba(0,86,255,.1),0 2px 5px -2px rgba(0,86,255,.05)
        }
        /* ... (resto de tus estilos se mantienen iguales) ... */
        .toast-notification {
            position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%);
            background-color: #1f2937; color: white; padding: 0.75rem 1.5rem;
            border-radius: 0.5rem; z-index: 9999; opacity: 0; transition: opacity 0.3s;
        }
        .toast-visible { opacity: 1; }
    </style>
</head>

<body class="text-gray-800 min-h-screen flex flex-col items-center p-4">
    <main class="w-full max-w-5xl mx-auto space-y-8 shadow-sm">
        <header class="text-center relative flex flex-col items-center">
            <div class="w-full flex justify-between items-center mb-6">
                <a href="index_menu.html" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-md shadow-md hover:bg-blue-700 transition-colors text-sm">Regresar al Menú</a>
                <button onclick="logout()" class="bg-red-600 text-white font-bold py-2 px-4 rounded-md shadow-md hover:bg-red-700 transition-colors text-sm">Cerrar Sesión</button>
            </div>
            
            <h1 class="text-4xl font-extrabold tracking-tight sm:text-5xl">Control Voley <span class="text-yellow-600">Stats Tracker</span></h1>
            <p class="mt-4 text-lg text-gray-500 font-medium">Monitorea el rendimiento de tus atletas en tiempo real.</p>
        </header>

        <div class="grid grid-cols-1 gap-8">
            <div class="card p-6 rounded-lg">
                <h2 class="text-2xl font-semibold mb-4 pb-2 border-b border-blue-600 text-blue-600">Registrar Acción</h2>
                <form id="actionForm" class="space-y-4">
                    <select id="playerSelect" class="w-full rounded-md px-3 py-2 border border-gray-300"></select>
                    <select id="actionSelect" class="w-full rounded-md px-3 py-2 border border-gray-300"></select>
                    <button type="submit" class="w-full bg-blue-600 text-white font-bold py-2 rounded-md hover:bg-blue-700">Registrar</button>
                </form>
            </div>
            <div id="scoresContainer" class="card p-6 rounded-lg"></div>
            <div class="h-96 card p-6 rounded-lg"><canvas id="barChart"></canvas></div>
        </div>
    </main>

    <script type="module">
        // --- CONFIGURACIÓN FIREBASE (Basada en tu referencia) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyB5RB7mm1j-0gjCNTUEJTkyEqLjyZ3C7ws",
            authDomain: "datacontrolvoley-ff556.firebaseapp.com",
            projectId: "datacontrolvoley-ff556",
            storageBucket: "datacontrolvoley-ff556.firebasestorage.app",
            messagingSenderId: "516409072606",
            appId: "1:516409072606:web:132538dba358a077d71b4f" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- LÓGICA DE PROTECCIÓN ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists() && userDoc.data().teamId) {
                    // USUARIO VÁLIDO: Mostramos la página e inicializamos la app
                    document.body.style.display = "block";
                    initializeAppLogic(); 
                } else {
                    alert("No tienes un equipo asignado.");
                    await signOut(auth);
                    window.location.href = 'index.html';
                }
            } else {
                // NO LOGUEADO
                window.location.href = 'index.html';
            }
        });

        window.logout = async function() {
            await signOut(auth);
            window.location.href = 'index.html';
        };

        // --- TODA TU LÓGICA ORIGINAL DE ESTADÍSTICAS VA AQUÍ DENTRO ---
        function initializeAppLogic() {
            // Aquí pegas todo el código de 'document.addEventListener('DOMContentLoaded'...'
            // que tenías antes (las variables l, m, m_current_set, funciones de gráficas, etc.)
            console.log("App de Estadísticas Inicializada para el club");
            
            // Ejemplo de enganche de eventos:
            const actionForm = document.getElementById('actionForm');
            // ... resto de tu lógica ...
        }
    </script>
</body>
</html>
